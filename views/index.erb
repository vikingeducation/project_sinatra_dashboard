
<% parsed_json = JSON.parse(json) %>
<% default_location = "#{parsed_json["city"]}, #{parsed_json["region_name"]}"%>

<html lang="en">
<head>
  <title>Job Search</title>
  <link rel="stylesheet" href=" https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
</head>
<div class="container">
  <h1>Job Search</h1>
  <form action="/"  method="post">
    <input type="text" name="position" placeholder="Job">
    <input type="text" name="location" value="<%=default_location%>">
    <input type="text" name="limit" placeholder="# of results">
    <input type="submit" value="submit">
  </form>
</div>


<% if position && location %>
  <% data = WebScraperProject::WebScraper.run({q: position, l: location, limit: limit}) %>


<div class="container">
  <h3><%=location%></h3>
  <table class="table table-striped">
    <tr>
      <th>Position</th>
      <th>Job Link</th>
      <th>Date</th>
      <th>Summary</th>
      <th>Employer</th>
      <th>Location</th>
      <th>Employer_ID</th>
      <th>Job ID</th>
      <th>Rating</th>
    </tr>
  <% data.each do |position| %>

    <tr>
    <% profiler = ProfilerHelper::CompanyProfiler.new(position[4]) %>

    <% position.each do |data| %>

      <td><%= data %></td>

    <% end %>

    <td>

    <% if profiler.find_job %>
      <% profiler.ratings.each do |description, rating| %>
          <%="#{description}: #{rating}\n" %>

      <% end %>
    <% end %>
    </td>

    </tr>
  <% end %>

  </table>
</div>
<% end %>
</html>
